<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üí™üèªPomodoro Motivacional</title>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    margin: 0;
  }
  h1 { font-size: 2.5rem; margin-bottom: 10px; }
  #timer { font-size: 4rem; margin-bottom: 20px; }
  .pomodoro-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: rgba(255,255,255,0.1);
    border-radius: 25px;
    padding: 30px;
    width: 90%;
    max-width: 500px;
    gap: 20px;
  }
  .buttons { display: flex; gap: 15px; margin-top: 10px; }
  .buttons button, .spotify-btn {
    padding: 12px 28px;
    border: none;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    color: #fff;
  }
  .spotify-btn { background: #1DB954; }
  iframe { width: 100%; max-width: 400px; border-radius: 12px; }
  .settings-block, .spotify-selection { display: flex; flex-direction: column; gap: 10px; width: 100%; align-items: center; }
  input { padding: 6px; border-radius: 8px; text-align: center; border: none; font-weight: bold; }
</style>
</head>
<body>

<h1>‚è≥ Pomodoro Motivacional</h1>
<div class="pomodoro-container">
  <div id="timer">25:00</div>

  <div class="buttons">
    <button onclick="pomodoroPlay()">‚ñ∂Ô∏è Iniciar</button>
    <button onclick="pomodoroPause()">‚è∏Ô∏è Pausa</button>
    <button onclick="pomodoroReset()">üîÑ Reiniciar</button>
  </div>

  <button class="spotify-btn" onclick="loginSpotify()">üéß Iniciar sesi√≥n con Spotify</button>

  <div class="spotify-selection">
    <input type="text" id="spotifyLink" placeholder="Pega tu playlist o √°lbum de Spotify aqu√≠">
    <button onclick="updateSpotifyEmbed()">Cargar en iframe</button>
  </div>

  <iframe id="spotifyEmbed" src="https://open.spotify.com/embed/playlist/2L7kwPaWFbe9JldHkHfI83?utm_source=generator&theme=0" height="380" frameborder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>

  <div class="settings-block">
    <label>Trabajo (min): <input type="number" id="workInput" value="25" min="1" max="90"></label>
    <label>Descanso (min): <input type="number" id="breakInput" value="5" min="1" max="30"></label>
  </div>
</div>

<script src="https://sdk.scdn.co/spotify-player.js"></script>
<script>
  // ===== Pomodoro =====
  let timer = null, isRunning = false, isWork = true, timeLeft = 25*60;
  const timerDisplay = document.getElementById("timer");
  const workInput = document.getElementById("workInput");
  const breakInput = document.getElementById("breakInput");
  const alarmSound = new Audio("Yo no pierdo, YO GANO!.mp3");

  function formatTime(seconds){ const m=Math.floor(seconds/60); const s=seconds%60; return `${m}:${s<10?'0':''}${s}`; }
  function updateTimer(){ if(!isRunning) return; timeLeft--; if(timeLeft<=0){ alarmSound.play(); isWork=!isWork; timeLeft=(isWork?parseInt(workInput.value):parseInt(breakInput.value))*60; } timerDisplay.textContent=formatTime(timeLeft); }
  function startTimer(){ if(isRunning) return; isRunning=true; timer=setInterval(updateTimer,1000);}
  function pauseTimer(){ clearInterval(timer); isRunning=false;}
  function resetTimer(){ clearInterval(timer); isRunning=false; isWork=true; timeLeft=parseInt(workInput.value)*60; timerDisplay.textContent=formatTime(timeLeft);}
  workInput.addEventListener('change',()=>{if(isWork) resetTimer();});
  breakInput.addEventListener('change',()=>{if(!isWork){timeLeft=parseInt(breakInput.value)*60; timerDisplay.textContent=formatTime(timeLeft);}});
  timerDisplay.textContent=formatTime(timeLeft);

  // ===== Spotify =====
  const clientId="1cc64379f36240daa6975df2a68b5e73";
  const redirectUri="https://alejandro78-sudo.github.io/Pomodoro/";
  const scopes="streaming user-read-email user-read-private user-read-playback-state user-modify-playback-state";
  let accessToken = null, player, deviceId;

  function loginSpotify(){
    const url=`https://accounts.spotify.com/authorize?client_id=${clientId}&response_type=token&redirect_uri=${encodeURIComponent(redirectUri)}&scope=${encodeURIComponent(scopes)}`;
    window.location.href=url;
  }

  function getTokenFromUrl(){ const hash=window.location.hash.substring(1); const params=new URLSearchParams(hash); return params.get("access_token"); }

  window.onload=()=>{
    accessToken=getTokenFromUrl();
    if(accessToken){ localStorage.setItem("spotifyToken",accessToken); window.location.hash=""; }
    else{ accessToken=localStorage.getItem("spotifyToken"); }
    if(accessToken) document.body.insertAdjacentHTML("beforeend", `<p style="color:#00ff99;font-weight:bold;">‚úÖ Sesi√≥n activa en Spotify</p>`);

    // Cargar playlist guardada
    const savedPlaylist=localStorage.getItem("spotifyPlaylist");
    const spotifyInput=document.getElementById("spotifyLink");
    const spotifyEmbed=document.getElementById("spotifyEmbed");
    if(savedPlaylist){ spotifyInput.value=savedPlaylist; spotifyEmbed.src=convertToEmbedURL(savedPlaylist); }
  };

  window.onSpotifyWebPlaybackSDKReady=()=>{
    if(!accessToken) return;
    player=new Spotify.Player({name:"Pomodoro üéµ",getOAuthToken:cb=>{cb(accessToken);},volume:0.5});
    player.addListener("ready",({device_id})=>{deviceId=device_id; console.log("Spotify listo:",deviceId);});
    player.connect();
  };

  function playPlaylist(uri){ if(!accessToken || !deviceId) return; fetch(`https://api.spotify.com/v1/me/player/play?device_id=${deviceId}`,{method:"PUT",body:JSON.stringify({context_uri:uri}),headers:{"Content-Type":"application/json","Authorization":`Bearer ${accessToken}`}});}
  function pauseMusic(){ if(!accessToken || !deviceId) return; fetch(`https://api.spotify.com/v1/me/player/pause?device_id=${deviceId}`,{method:"PUT",headers:{"Authorization":`Bearer ${accessToken}`}});}
  function pomodoroPlay(){ if(!isRunning) startTimer(); const savedPlaylist=localStorage.getItem("spotifyPlaylist"); if(savedPlaylist && accessToken && deviceId){ const type=savedPlaylist.includes("/album/")?"album":"playlist"; playPlaylist(`spotify:${type}:${extractSpotifyId(savedPlaylist)}`);}}
  function pomodoroPause(){ pauseTimer(); pauseMusic(); }
  function pomodoroReset(){ resetTimer(); pauseMusic(); }

  function convertToEmbedURL(url){ return url.replace("open.spotify.com/","open.spotify.com/embed/")+"?utm_source=generator&theme=0"; }
  function updateSpotifyEmbed(){ const spotifyInput=document.getElementById("spotifyLink"); const spotifyEmbed=document.getElementById("spotifyEmbed"); const link=spotifyInput.value.trim(); if(!link) return alert("Pega un link v√°lido de Spotify."); spotifyEmbed.src=convertToEmbedURL(link); localStorage.setItem("spotifyPlaylist",link);}
  function extractSpotifyId(url){ const parts=url.split("/"); return parts[parts.length-1].split("?")[0]; }

</script>
</body>
</html>
